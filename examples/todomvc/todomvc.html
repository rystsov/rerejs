<html>
    <head>
        <style type="text/css">
        </style>
        <script src="../require.js"></script>
        <script type="text/javascript">
            require.config({
                paths: {
                    "rere": "../../rerejs"
                }
            });
        </script>
    </head>
    <body>
        <div id="canvas">
        </div>
    </body>
    <script type="text/javascript">
        require(
            ["rere/rere"], 
            function(rere) {
                var canvas = document.getElementById("canvas");
                var renderer = rere.ui.renderer;
                var Variable = rere.reactive.Variable;
                var hacks = rere.ui.hacks;
                var rv = rere.reactive.rv;
                var H = renderer.h;

                renderer.render(canvas, 
                ["div", 
                    ["@", 
                        ["css", 
                            ["width", "500px"],["background-color", "azure"]]
                    ],
                    (function(name){
                        var control = new Variable();
                        function label() {
                            control.set(H(renderer.parse(
                                ["span", ["!", { dblclick: textbox }], new rere.ui.Text(name)]
                            )));
                            name.commit();
                        }
                        function textbox() {
                            name.batch();
                            control.set(H(renderer.parse(
                                ["input-text", name.core, ["!", {blur: hacks.unrecursion(label)}]]
                            )));
                        }

                        label();
                        return ["div",
                            ["form",
                                ["!", {submit: function(element, view, event){
                                    event.preventDefault();
                                    label();
                                }}],
                                H(control)]
                        ];
                    })(rv.batch(new Variable("TodoMVC")))
                ]);
            }
        );
    </script>
</html>
