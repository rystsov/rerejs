<html>
    <head>
        <script src="../../target/warp9.js"></script>
    </head>
    <body>
        <div id="canvas"></div>
    </body>
    <script type="text/javascript">
        var List = warp9.reactive.List;
        var Cell = warp9.reactive.Cell;

        warp9.ui.renderer.addTag("linkbutton", function(opt) {
            var args = warp9.ui.tags.utils.parseTagArgs(opt);
            var attr = warp9.ui.tags.utils.normalizeAttributes(args.attr);

            var css = {};
            warp9.ui.tags.utils.tryEnrich(css, attr.attributes.css);
            warp9.ui.tags.utils.tryEnrich(css, {
                "text-decoration": "none",
                "border-bottom": "1px dashed",
                "color": "blue",
                "cursor": "pointer",
                "warp9:disabled": {
                    "cursor": "default",
                    "color": "#585858"
                }
            });

            var disabled;
            if ("warp9:disabled" in attr.attributes) {
                disabled = attr.attributes["warp9:disabled"];
                if (typeof disabled=="boolean") disabled = new Cell(disabled);
                delete attr.attributes["warp9:disabled"];
            } else {
                disabled = new Cell();
            }
            disabled = disabled.coalesce(false);

            var click = attr.events.click ? attr.events.click : function(){};
            attr.events.click = function() {
                if (disabled.unwrap()) return;
                click();
            };

            for (var key in css["warp9:disabled"]) {
                if (!css["warp9:disabled"].hasOwnProperty(key)) continue;
                if (!css.hasOwnProperty(key)) throw new Error(key + " in css/warp9:disabled but not in css");
                css[key] = disabled.when(false, css[key]).coalesce(css["warp9:disabled"][key]);
            }
            delete css["warp9:disabled"];

            attr.attributes.css = css;
            attr.attributes.href = "#";

            attr = warp9.ui.tags.utils.denormalizeAttributes(attr);

            return warp9.ui.renderer.parse(["a", attr, args.attr==null ? opt[0] : opt[1]]);
        });

        function LIST_TEST() {
            var list = new List([]);
            return ["div",
                ["linkbutton", {
                    "!click": function() {
                        list.add(function(id){ return id; });
                    }
                }, "click me"],

                ["div", list.lift(function(item){
                    return ["div", "item #" + item];
                })]
            ];
        }

        var renderer = warp9.ui.renderer;
        renderer.render(canvas, LIST_TEST());
    </script>
</html>
