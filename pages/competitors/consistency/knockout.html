<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Wapr9 / Atomic updates / Knockout</title>

    <link href="../../../lib/highlight.js/styles/default.css" rel="stylesheet" >
    <script src="../../../lib/highlight.js/highlight.pack.js"></script>
    <script src="../../../lib/highlight.hack.js"></script>

    <link href="../../../lib/bootstrap/css/bootstrap.css" rel="stylesheet">
    <link href="../../../css/common.css" rel="stylesheet">
    <link href="consistency.css" rel="stylesheet">
</head>

<body>

<div class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <a class="navbar-brand" href="../../../index.html">WARP9</a>
        </div>
        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li><a href="../../docs/docs.html">Docs</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Competitor analysis <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a href="../matrix.html">Matrix</a></li>
                        <li class="divider"></li>
                        <li><a href="../leaks/leaks.html">Accidental memory leaks</a></li>
                        <li><a href="../diamond/diamond.html">Repeated diamonds shape</a></li>
                        <li><a href="../consistency/consistency.html">Atomic updates</a></li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Examples <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a href="../../../examples/todomvc/todomvc.html">TodoMVC</a></li>
                    </ul>
                </li>
                <li><a href="../../download.html">Download</a></li>
                <li><a href="https://github.com/rystsov/warp9">Sources</a></li>
            </ul>
        </div>
    </div>
</div>

<div class="container">
    <!-- Main component for a primary marketing message or call to action -->
    <div class="jumbotron">
        <h1>Atomic updates</h1>
        <p>
            Knockout doesn't support atomic updates, but provides a workaround. If you want to
            simultaneously update two reactive variable you have to track all reactive variables that
            depend on them and add <code>.extend({throttle:delay})</code> to each. <code>delay</code>
            is an interval in ms to await all dependencies to be updated.
        </p>
        <p>
            <a class="btn btn-lg btn-primary btn-info" href="consistency.html">Details</a>
            <a class="btn btn-lg btn-primary btn-warning" href="knockout.html">Knockout</a>
            <a class="btn btn-lg btn-primary" href="reactive_coffee.html">Reactive Coffee</a>
            <a class="btn btn-lg btn-primary" href="warp9.html">Warp9</a>
        </p>
    </div>
</div>

<div class="container">
    <div class="starter-template">
        <div class="row">
            <div class="col-md-6">
                <div class="app">
                    <p>
                        I can't say that such approach to handle atomic updates is best, because if
                        <code>delay</code> is too small you lose atomically and if it is too high you
                        may get a visible delay in the user interface.
                    </p>
                    <p>
                        Move over it breaks composability
                        because it violates locality of change: to make an atomic update on some variables
                        we have to alter all its dependants (which may be spread all over the code) and not
                        to forget to alter its future dependants.
                    </p>
                    <div class="knockout">
                        <div>
                            <div class="accounts-title">
                                <div><b>Alice's account</b></div>
                                <div><b>Bob's account</b></div>
                            </div>
                            <div class="accounts-value">
                                <div><span data-bind='text: alice() + "$"'></span></div>
                                <div><span data-bind='text: bob() + "$"'></span></div>
                            </div>
                            <div class="clear"></div>
                        </div>
                        <div class="transfer">
                            <input type="text" data-bind="value: parcel" />
                            <button data-bind="click: update">Transfer from Alice to Bob</button>
                        </div>
                        <div class="history">
                            <div><b>Accounts history</b></div>
                            <div class="snapshots" data-bind="foreach: history">
                                <div data-bind="text: $data"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <p>HTML</p>
                <pre><code id="html"><!--<div>
    <div class="accounts-title" style="float: left;">
        <div><b>Alice's account</b></div>
        <div><b>Bob's account</b></div>
    </div>
    <div class="accounts-value">
        <div><span data-bind='text: alice() + "$"'></span></div>
        <div><span data-bind='text: bob() + "$"'></span></div>
    </div>
    <div class="clear"></div>
</div>
<div class="transfer">
    <input type="text" data-bind="value: parcel" />
    <button data-bind="click: update">Transfer from Alice to Bob</button>
</div>
<div class="history">
    <div><b>Accounts history</b></div>
    <div class="snapshots" data-bind="foreach: history">
        <div data-bind="text: $data"></div>
    </div>
</div>--></code></pre>

                <p>JS</p>
                <pre><code>var model = new ViewModel();
ko.applyBindings(model);

function ViewModel() {
    this.alice = ko.observable(10);
    this.bob = ko.observable(15);
    this.parcel = ko.observable("2");
    this.history = ko.observableArray([]);
    ko.computed(function(){
        this.history.push(JSON.stringify({
            Alice: this.alice() + "$",
            Bob: this.bob() + "$",
            sum: (this.alice() + this.bob()) + "$"
        }));
    }, this).extend({ throttle: 50 });

    this.update = function() {
        this.alice(this.alice() - parseInt(this.parcel()));
        this.bob(this.bob() + parseInt(this.parcel()));
    }
}</code></pre>
            </div>
        </div>
    </div>
</div>


<script src="../../../lib/jquery/jquery-2.0.3.min.js"></script>
<script src="../../../lib/bootstrap/js/bootstrap.min.js"></script>
<script src="../../../lib/knockout/knockout-3.0.0rc.js"></script>

<script language="JavaScript">
    hljs.initHighlightingOnLoad();
    uncommentAndHighlight(html);

    var model = new ViewModel();
    ko.applyBindings(model);

    function ViewModel() {
        this.alice = ko.observable(10);
        this.bob = ko.observable(15);
        this.parcel = ko.observable("2");
        this.history = ko.observableArray([]);
        ko.computed(function(){
            this.history.push(JSON.stringify({
                Alice: this.alice() + "$",
                Bob: this.bob() + "$",
                sum: (this.alice() + this.bob()) + "$"
            }));
        }, this).extend({ throttle: 50 });

        this.update = function() {
            this.alice(this.alice() - parseInt(this.parcel()));
            this.bob(this.bob() + parseInt(this.parcel()));
        }
    }
</script>
</body>
</html>
